// -----------------------------
// Nextflow configuration file
// -----------------------------

manifest {
  name            = 'pacbio-hdv-pipeline'
  author          = 'Onkar Singh'
  description     = 'PacBio HDV Analysis Pipeline'
  version         = '2.0.0'
  nextflowVersion = '>=22.10.0'
  homePage        = 'https://github.com/onkarS23/pacbio-hdv-pipeline'
  mainScript      = 'main_v2.nf'
}

params {
  // Defaults (also set in main_v2.nf). CLI flags always override.
  input_dir = "${projectDir}/test_input"
  outdir    = "${projectDir}/results"
  human_ref = "${projectDir}/data/hg38.fa"
  hdv_ref   = "${projectDir}/data/hdv_ref.fa"
  threads   = 16
}

// -----------------------------
// Process-wide settings
// -----------------------------
process {
  executor      = 'local'
  cpus          = { params.threads }
  memory        = { 16.GB * task.attempt }
  time          = { 4.h * task.attempt }
  errorStrategy = 'retry'
  maxRetries    = 2

  // If you have a separate env for RVHAPLO, uncomment this and add the file:
  // withName: RVHAPLO {
  //   conda = "${projectDir}/envs/rvhaplo-v2.yml"
  // }
}

// -----------------------------
// Profiles
// -----------------------------
profiles {

  // Conda-managed tools (recommended)
  conda {
    conda.enabled = true
    // This makes Nextflow create/activate the env from your repo for each process
    process.conda = "${projectDir}/environment_v2.yml"
  }

  // Minimal test profile (small threads + repo-relative test data)
  test {
    params {
      input_dir = "${projectDir}/test_input"
      outdir    = "${projectDir}/test_results"
      threads   = 4
    }
  }

  // Optional containerized runs (set image if you publish one)
  docker {
    docker.enabled    = true
    process.container = 'ghcr.io/onkarS23/pacbio-hdv:latest'
  }

  singularity {
    singularity.enabled = true
    process.container   = 'docker://ghcr.io/onkarS23/pacbio-hdv:latest'
  }
}
